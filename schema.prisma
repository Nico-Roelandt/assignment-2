generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model books {
  id               Int         @id @default(autoincrement())
  title            String      @db.VarChar(255)
  author           String      @db.VarChar(200)
  publisher        String?     @db.VarChar(200)
  summary          String?     @db.Text
  isbn             String      @unique(map: "uk_books_isbn") @db.VarChar(20)
  price            Decimal     @db.Decimal(10, 2)
  publication_date DateTime?   @db.Date
  created_at       DateTime    @default(now()) @db.DateTime(0)
  updated_at       DateTime    @default(now()) @db.DateTime(0)
  carts            carts[]
  discounts        discounts[]
  favorites        favorites[]
  orders           orders[]
  reviews          reviews[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model carts {
  id       Int   @id @default(autoincrement())
  user_id  Int
  book_id  Int
  quantity Int
  books    books @relation(fields: [book_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_carts_book")
  users    users @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_carts_user")

  @@index([book_id], map: "fk_carts_book")
  @@index([user_id], map: "fk_carts_user")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model coupons {
  id            Int      @id @default(autoincrement())
  code          String   @unique(map: "code") @db.VarChar(50)
  coupon_amount Decimal  @db.Decimal(10, 2)
  start         DateTime @db.DateTime(0)
  end           DateTime @db.DateTime(0)
  is_valid      Boolean  @default(true)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model discounts {
  id            Int      @id @default(autoincrement())
  book_id       Int
  discount_rate Decimal  @db.Decimal(5, 2)
  start         DateTime @db.DateTime(0)
  end           DateTime @db.DateTime(0)
  is_valid      Boolean  @default(true)
  books         books    @relation(fields: [book_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_discounts_book")

  @@index([book_id], map: "fk_discounts_book")
}

model favorites {
  id      Int   @id @default(autoincrement())
  user_id Int
  book_id Int
  books   books @relation(fields: [book_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_favorites_book")
  users   users @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_favorites_user")

  @@index([book_id], map: "fk_favorites_book")
  @@index([user_id], map: "fk_favorites_user")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model orders {
  id            Int          @id @default(autoincrement())
  settlement_id Int?
  book_id       Int
  user_id       Int
  status        String       @db.VarChar(50)
  quantity      Int
  created_at    DateTime     @default(now()) @db.DateTime(0)
  updated_at    DateTime     @default(now()) @db.DateTime(0)
  books         books        @relation(fields: [book_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_orders_book")
  settlements   settlements? @relation(fields: [settlement_id], references: [id], onUpdate: NoAction, map: "fk_orders_settlement")
  users         users        @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_orders_user")

  @@index([book_id], map: "fk_orders_book")
  @@index([settlement_id], map: "fk_orders_settlement")
  @@index([user_id], map: "fk_orders_user")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model reviews {
  id         Int      @id @default(autoincrement())
  book_id    Int
  user_id    Int
  rating     Int
  comment    String?  @db.Text
  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @default(now()) @db.DateTime(0)
  books      books    @relation(fields: [book_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_reviews_book")
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_reviews_user")

  @@index([book_id], map: "fk_reviews_book")
  @@index([user_id], map: "fk_reviews_user")
}

model sellers {
  id              Int           @id @default(autoincrement())
  business_number String?       @unique(map: "business_number") @db.VarChar(50)
  business_name   String        @db.VarChar(255)
  email           String        @unique(map: "email") @db.VarChar(255)
  phone_number    String        @db.VarChar(50)
  address         String        @db.VarChar(255)
  payout_bank     String        @db.VarChar(100)
  payout_account  String        @db.VarChar(100)
  payout_holder   String        @db.VarChar(100)
  settlements     settlements[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model settlements {
  id              Int      @id @default(autoincrement())
  seller_id       Int
  total_sales     Decimal  @db.Decimal(12, 2)
  commission      Decimal  @db.Decimal(12, 2)
  final_payout    Decimal  @db.Decimal(12, 2)
  period_start    DateTime @db.Date
  period_end      DateTime @db.Date
  settlement_date DateTime @db.DateTime(0)
  orders          orders[]
  sellers         sellers  @relation(fields: [seller_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_settlements_seller")

  @@index([seller_id], map: "fk_settlements_seller")
}

model users {
  id           Int         @id @default(autoincrement())
  is_admin     Boolean
  email        String      @unique(map: "uk_users_email") @db.VarChar(255)
  password     String      @db.VarChar(255)
  name         String      @db.VarChar(100)
  birth_date   DateTime?   @db.Date
  gender       String?     @db.VarChar(20)
  address      String?     @db.VarChar(255)
  phone_number String?     @db.VarChar(30)
  created_at   DateTime    @default(now()) @db.DateTime(0)
  carts        carts[]
  favorites    favorites[]
  orders       orders[]
  reviews      reviews[]
}
